# TLS通讯过程
![TLS通讯过程](https://raw.githubusercontent.com/luobosiji/blog/master/resources/nginx/tls-communication.png)
1. client hello 浏览器告诉服务器我支持哪些加密算法
2. server hello 服务器从加密算法列表中选择加密套件给客户端
   1. nginx可以打开session_cache，在一定时间内断开连接的客户端不用再次协商密钥，复用密钥
3. 服务端把公钥证书（包含证书链）发送给浏览器
   1. 浏览器根据根证书库，验证证书是否有效
   2. 在下一步进行之前，服务器会把椭圆曲线参数发给客户端，方便第6步生成加密密钥
4. server hello done  这个过程结束
5. 客户端根据椭圆曲线参数生成私钥，且把公钥发送给服务端
6. 服务端把公钥发送给客户端，并且根据客户端公钥+自己私钥 生成加密密钥
   1. 客户端根据自己私钥+客户端公钥生成加密密钥
   2. 此时各自生成的加密密钥是相同的（非对称算法技术来保证）
7. 加密、通信

**握手过程性能**
- 主要看椭圆加密算法、非对称加密算法性能

**TLS通讯性能**
- 小文件主要看握手过程
- 大文件主要看数据加密过程

可以通过优化算法、降低密码强度 来提升性能